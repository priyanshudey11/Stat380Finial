---
title: "Final_Project"
author: Ahsan Sultan, Priyanshu Dey, Janvi Ahuja, Daniel Miller
output: html_document
date: "2024-12-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#Loading in Essential Libraries
library(tidyverse)
library(ggplot2)

#Loading in the Data
CODGames_p1_380 <- read.csv("~/Downloads/CODGames_p1_380.csv") #589 rows, 27 columns
CODGames_p2_380 <- read.csv("~/Downloads/CODGames_p2_380.csv") #250 rows, 27 columns
CODMaps <- read.csv("~/Downloads/CODMaps.csv")
CODGameModes <- read.csv("~/Downloads/CODGameModes.csv")
```


My thought process is that after reading through the Final Project PDF and going over the data csvs I realized that most of the CSVs need some cleansing to do. Since CODGames_p1_380 and CODGames_p2_380 are basically about a player each and their rankings in the online game, I think we should merge the dataframes to make it one more combined dataframe. I also realized that each of the two csvs have null values in the map and choices column so it would be important to remove them to keep all values in check. There are also trailing spaces as highlighted in the document so we would have to remove that also. I think it would be smart to eliminate rows that have missing choice values because they cant determine the winner. My thinking for the map winning criteria was to get unique maps from both map1 and map2 and then count the number of times they appear and then count wins where the map was chosen. Then I would count win from ties when map was map1.

```{r}
### I feel we should double check if we should use rbind or bind_rows
combined <- bind_rows(CODGames_p1_380, CODGames_p2_380)

combined <- combined %>%
  mutate(Map1 = trimws(Map1),
         Map2 = trimws(Map2),
         Choice = trimws(Choice)) %>%
  filter(!is.na(Map1) & !is.na(Map2) & !is.na(Choice)) 
```

### Calculating Map Choices Ratio/Stats
```{r}
calculate_win_stats <- function(data) {

    # Get unique maps
    maps <- data %>%
        select(Map1, Map2) %>%
        unlist() %>%
        unique() %>%
        .[!is.na(.)]
    
    # Initialize results dataframe
    results <- data.frame(
        Map = maps,
        Appearances = 0,
        Regular_Wins = 0,
        Tie_Wins = 0,
        Win_Rate = 0
    )
    
    for (map in maps) {
        # Calculate statistics using pipes
        stats <- data %>%
            summarize(
                appearances = sum(Map1 == map | Map2 == map, na.rm = TRUE),
                regular_wins = sum(Choice == map & 
                                 MapVote != paste(Map1, "to", Map1), 
                                 na.rm = TRUE),
                tie_wins = sum(Map1 == map & 
                             MapVote == paste(Map1, "to", Map1), 
                             na.rm = TRUE)
            )
        
        # Calculate win rate
        total_wins <- stats %>% 
            transmute(total = regular_wins + tie_wins) %>% 
            pull()
        
        win_rate <- round((total_wins / stats$appearances) * 100, 2)
        
        # Update results
        results[results$Map == map,] <- c(map, 
                                        stats$appearances, 
                                        stats$regular_wins,
                                        stats$tie_wins, 
                                        win_rate)
    }
    
    return(results)
}
```


```{r}
maxresults <- calculate_win_stats(combined)
```

### Visualization
```{r}
ggplot(maxresults, aes(x = reorder(Map, Win_Rate), y = Win_Rate)) +
    geom_bar(stat = "identity", fill = "red") +
    coord_flip() +
    theme_minimal() +
    labs(title = "Map Win Rates in Voting",
         x = "Map",
         y = "Win Rate (%)") +
    theme(axis.text.y = element_text(size = 6), axis.text.x = element_text(size=4.5))
```

To answer research question we looked at the graph/chart for the following insights:

Nuketown '84 variants dominate with the highest win rates (Halloween version at 100%, regular version at 82%)
Crossroads Strike shows strong performance with a 77.6% win rate
Raid and Standoff are consistently popular choices, winning 75% and 70% of their appearances respectively